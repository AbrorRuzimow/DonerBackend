{% extends 'administrator/base/base.html' %}
{% block content %}
    <div class="app-main flex-column flex-row-fluid" id="dms_main">
        <div class="d-flex flex-column flex-column-fluid">
            <div id="dms_toolbar" class="app-toolbar pt-6 pb-2 ">
                <div id="dms_toolbar_container" class="app-container container-fluid d-flex align-items-stretch">
                    <div class="app-toolbar-wrapper d-flex flex-stack flex-wrap gap-4 w-100">
                        <div class="page-title d-flex flex-column justify-content-center gap-1 me-3">
                            <h1 class="page-heading d-flex flex-column justify-content-center text-gray-900 fw-bold fs-3 m-0">
                                Önümler
                            </h1>
                        </div>
                    </div>
                </div>
            </div>
            <div class="app-content flex-column-fluid">
                <div id="dms_content_container" class="app-container container-fluid ">
                    <div class="card card-flush">
                        <div class="card-header align-items-center py-5 gap-1 gap-md-5">
                            <div class="card-title gap-4">
                                <div class="d-flex align-items-center position-relative mt-2 gap-4">
                                    <label>
                                        <select class="form-select mb-2" data-control="select2" data-hide-search="true" name="status" multiple data-placeholder="Ýagdaýy saýlaň" id="kt_ecommerce_add_product_status_select" required>
                                            {% for status in order_status_list %}
                                                <option value="{{ status.0 }}" {% for order in order_status %}{% if order == status.0 %}selected{% endif %}{% endfor %}>{{ status.1 }}</option>
                                            {% endfor %}
                                        </select>
                                    </label>
                                </div>
                                <div class="d-flex align-items-center position-relative gap-2">
                                    <input type="text" class="form-control form-control-solid w-250px" name="search" id="search_input" value="{{ search }}" placeholder="Gözleg..."/>
                                    <button type="button" onclick="formSearch()" data-bs-toggle="tooltip" title="Gözleg" data-bs-custom-class="tooltip-inverse" class="btn btn-light btn-active-color-primary light cursor-pointer w-25px justify-content-center align-items-center" style="display: flex">
                                        <i class="fas fa-search fs-4"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="card-toolbar flex-row-fluid justify-content-end gap-5">
                                <div class="card-toolbar flex-row-fluid justify-content-end gap-5">
                                    <div class="d-flex justify-content-center align-items-center gap-4">
                                        <h4 class="text-gray-900 cursor-default">Jemi: {{ models_all }}</h4>
                                    </div>

                                </div>
                            </div>
                        </div>
                        <div class="card-body pt-0">
                            <table class="table align-middle table-row-dashed fs-6 gy-5" id="kt_models_table">
                                <thead>
                                <tr class="text-start text-gray-500 fw-bold fs-7 text-uppercase gs-0">
                                    <th class="cursor-default">Ady</th>
                                    <th class="cursor-default">Telefon belgi</th>
                                    <th class="cursor-default">Bahasy</th>
                                    <th class="cursor-default">Hyzmaty</th>
                                    <th class="cursor-default">Tölegiń görnüşi</th>
                                    <th class="cursor-default">Wagty</th>
                                    <th class="text-end cursor-default">Ýagdaýy</th>
                                </tr>
                                </thead>
                                <tbody class="fw-semibold text-gray-600">
                                {% for model in models %}
                                    <tr>
                                        <td>
                                            <div class="d-flex align-items-center">
                                                <div class="ms-5">
                                                    <a href="{% url 'Administrator:order_detail_list' model.name %}" class="text-gray-800 text-hover-primary fs-5 fw-bold" data-kt-ecommerce-product-filter="product_name">{{ model.name }}</a>
                                                </div>
                                            </div>
                                        </td>
                                        <td>
                                            <div class="d-flex align-items-center">
                                                <div class="text-gray-800 fs-5 fw-bold cursor-default">
                                                    {{ model.phone_number }}
                                                </div>
                                            </div>
                                        </td>
                                        <td>
                                            <div class="d-flex align-items-center">
                                                <div class="text-gray-800 fs-5 fw-bold cursor-default">
                                                    {{ model.total_price }}
                                                </div>
                                            </div>
                                        </td>
                                        <td>
                                            <div class="d-flex align-items-center">
                                                <div class="text-gray-800 fs-5 fw-bold cursor-default">
                                                    {{ model.delivery_price }}
                                                </div>
                                            </div>
                                        </td>
                                        <td>
                                            <div class="d-flex align-items-center">
                                                <div class="text-gray-800 fs-5 fw-bold cursor-default">
                                                    {% for payment_type in payment_type_list %}
                                                        {% if model.payment_type == payment_type.0 %}
                                                            <div class="badge badge-light">{{ payment_type.1 }}</div>
                                                        {% endif %}
                                                    {% endfor %}
                                                </div>
                                            </div>
                                        </td>
                                        <td>
                                            <div class="d-flex align-items-center">
                                                <div class="text-gray-800 fs-5 fw-bold cursor-default">
                                                    {{ model.date }}
                                                </div>
                                            </div>
                                        </td>
                                        <td class="text-end">
                                            <div class="btn-center text-end" data-kt-menu-trigger="click" data-kt-menu-placement="bottom-end">
                                                <div class="text-gray-800 fw-bold cursor-default">
                                                    {% for order_status in order_status_list %}
                                                        {% if model.order_state == order_status.0 %}
                                                            <div class="badge badge-light-{% if model.order_state == '1' %}info{% elif model.order_state == '2' %}primary{% elif model.order_state == '3' %}success{% else %}danger{% endif %}">{{ order_status.1 }}</div>
                                                        {% endif %}
                                                    {% endfor %}
                                                </div>
                                            </div>
                                        </td>
                                    </tr>
                                {% endfor %}
                                </tbody>
                            </table>
                            <div class="row">
                                <div class="col-sm-12 col-md-5 d-flex align-items-center justify-content-center justify-content-md-start">
                                    <div class="dataTables_length">
                                        <label>
                                            <select name="limit" class="form-select form-select-sm form-select-solid" id="limit_input"
                                                    onchange="form_limit()">
                                                <option value="10" {% if limit == '10' %} selected {% endif %}>10</option>
                                                <option value="25" {% if limit == '25' %} selected {% endif %}>25</option>
                                                <option value="50" {% if limit == '50' %} selected {% endif %}>50</option>
                                                <option value="100" {% if limit == '100' %} selected {% endif %}>100
                                                </option>
                                            </select>
                                        </label>
                                    </div>
                                </div>
                                <div class="col-sm-12 col-md-7 d-flex align-items-center justify-content-center justify-content-md-end">
                                    <div class="dataTables_paginate paging_simple_numbers" id="kt_inbox_listing_paginate">
                                        <ul class="pagination">
                                            {% if page_obj.has_previous %}
                                                <li class="paginate_button page-item previous"><a
                                                        href="?page={{ page_obj.previous_page_number }}&&warehouse={{ warehouse_get }}&date={{ date_get }}&status={{ status_get }}&limit={{ limit }}"
                                                        class="page-link">Yza</a></li>
                                            {% else %}
                                                <li class="paginate_button page-item previous disabled"
                                                    style="cursor:no-drop;"><a href="" class="page-link">Yza</a></li>
                                            {% endif %}
                                            {% if page_obj.number|add:'-4' > 1 %}
                                                <li class="paginate_button page-item"><a
                                                        href="?page=1&warehouse={{ warehouse_get }}&date={{ date_get }}&status={{ status_get }}&limit={{ limit }}"
                                                        class="page-link">1</a></li>
                                                <li class="paginate_button page-item"><a
                                                        href="?page={{ page_obj.number|add:'-4' }}&warehouse={{ warehouse_get }}&date={{ date_get }}&status={{ status_get }}&limit={{ limit }}"
                                                        class="page-link">&hellip;</a></li>
                                            {% endif %}
                                            {% for i in page_obj.paginator.page_range %}
                                                {% if page_obj.number == i %}
                                                    <li class="paginate_button page-item active"><a
                                                            href="?page={{ i }}&warehouse={{ warehouse_get }}&date={{ date_get }}&status={{ status_get }}&limit={{ limit }}"
                                                            class="page-link">{{ i }}</a></li>
                                                {% elif i > page_obj.number|add:'-4' and i < page_obj.number|add:'4' %}
                                                    <li class="paginate_button page-item"><a
                                                            href="?page={{ i }}&warehouse={{ warehouse_get }}&date={{ date_get }}&status={{ status_get }}&limit={{ limit }}"
                                                            class="page-link">{{ i }}</a></li>
                                                {% endif %}
                                            {% endfor %}
                                            {% if page_obj.paginator.num_pages > page_obj.number|add:'4' %}
                                                <li class="paginate_button page-item"><a
                                                        href="?page={{ page_obj.number|add:'4' }}&warehouse={{ warehouse_get }}&date={{ date_get }}&status={{ status_get }}&limit={{ limit }}"
                                                        class="page-link">&hellip;</a></li>
                                                <li class="paginate_button page-item"><a
                                                        href="?page={{ page_obj.paginator.num_pages }}&warehouse={{ warehouse_get }}&date={{ date_get }}&status={{ status_get }}&limit={{ limit }}"
                                                        class="page-link">{{ page_obj.paginator.num_pages }}</a></li>
                                            {% endif %}
                                            {% if page_obj.has_next %}
                                                <li class="paginate_button page-item next"><a
                                                        href="?page={{ page_obj.next_page_number }}&warehouse={{ warehouse_get }}&date={{ date_get }}&status={{ status_get }}&limit={{ limit }}"
                                                        class="page-link">Öňe</a></li>
                                            {% else %}
                                                <li class="paginate_button page-item next disabled" style="cursor:no-drop;">
                                                    <a href="" class="page-link">Öňe</a></li>
                                            {% endif %}
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
{% endblock %}

{% block js %}
    <script>
        "use strict";
        var KTAppEcommerceSalesListing = function () {
            var e, t, n, r, o, a = (e, n, a) => {
                r = e[0] ? new Date(e[0]) : null, o = e[1] ? new Date(e[1]) : null, $.fn.dataTable.ext.search.push((function (e, t, n) {
                    var a = r, c = o, l = new Date(moment($(t[5]).text(), "DD/MM/YYYY")), u = new Date(moment($(t[6]).text(), "DD/MM/YYYY"));
                    return null === a && null === c || null === a && c >= u || a <= l && null === c || a <= l && c >= u
                })), t.draw()
            }
            return {
                init: function () {
                    (e = document.querySelector("#kt_models_table")) && ((t = $(e).DataTable({info: !1, order: [], pageLength: 10, columnDefs: [{orderable: !1, targets: 0}, {orderable: !1, targets: 7}]})).on("draw", (function () {
                        c()
                    })), (() => {
                        const e = document.querySelector("#kt_table_flatpickr");
                        n = $(e).flatpickr({
                            altInput: !0, altFormat: "d/m/Y", dateFormat: "Y-m-d", mode: "range", onChange: function (e, t, n) {
                                a(e, t, n)
                            }
                        })
                    })(),
                        document.querySelector('[data-kt-table-filter="status"]').addEventListener("keyup", (function (e) {
                            t.search(e.target.value).draw()
                        })))
                }
            }
        }();
        KTUtil.onDOMContentLoaded((function () {
            KTAppEcommerceSalesListing.init()
        }));
    </script>
    <script>

        let delete_bool = true;
        document.getElementById("delete_btn").disabled = true;

        function delete_btn_count() {
            document.getElementById("delete_btn").disabled = document.querySelectorAll('input[type="checkbox"]:checked').length < 1;
        }

        function delete_all_btn() {
            delete_bool = !delete_bool
            document.getElementById("delete_btn").disabled = delete_bool
        }

        function item_delete(url) {
            Swal.fire({
                text: "Siz bu maglumaty pozmak islýärsiňizmi?",
                icon: "warning",
                showCancelButton: !0,
                buttonsStyling: !1,
                confirmButtonText: "Howa!",
                cancelButtonText: "Ýok",
                customClass: {confirmButton: "btn fw-bold btn-danger", cancelButton: "btn fw-bold btn-active-light-primary"}
            }).then((function (e) {
                e.value ? Swal.fire(
                    {text: "Maglumat pozuldy!.", icon: "success", buttonsStyling: !1, confirmButtonText: "Dowam et", customClass: {confirmButton: "btn fw-bold btn-primary"}}).then((function () {
                    window.location.href = `${url}`
                    t.row($(n)).remove().draw()
                })) : "cancel" === e.dismiss && Swal.fire({text: "Pozmak amaly ýerine ýetmedi", icon: "error", buttonsStyling: !1, confirmButtonText: "Dowam et", customClass: {confirmButton: "btn fw-bold btn-primary"}})
            }));
        }

        function getSelectValues(select) {
            let result = [];
            let options = select && select.options;
            let opt;

            for (let i = 0, iLen = options.length; i < iLen; i++) {
                opt = options[i];

                if (opt.selected) {
                    result.push(opt.value || opt.text);
                }
            }
            return result;
        }

        function formSearch() {
            let search_input = document.getElementById('search_input').value
            let status = document.getElementById('kt_ecommerce_add_product_status_select')
            let select = Array.from(status.selectedOptions).map(option => option.value);

            window.location.href = `?search=${search_input}&page=1&&status=${select}`
        }

        function form_limit() {
            let warehouse = document.getElementById('warehouse_value')
            let date = document.getElementById('kt_table_flatpickr').value
            let status = document.getElementById('status_value').value
            let limit = document.getElementById('limit_input').value
            window.location.href = `?warehouse=${getSelectValues(warehouse)}&page=1&date=${date}&status=${status}&limit=${limit}`
        }
    </script>
{% endblock %}
