{% extends 'administrator/base/base.html' %}
{% block content %}
    <div class="app-main flex-column flex-row-fluid" id="dms_main">
        <div class="d-flex flex-column flex-column-fluid">
            <div id="dms_toolbar" class="app-toolbar pt-6 pb-2 ">
                <div id="dms_toolbar_container" class="app-container container-fluid d-flex align-items-stretch">
                    <div class="app-toolbar-wrapper d-flex flex-stack flex-wrap gap-4 w-100">
                        <div class="page-title d-flex flex-column justify-content-center gap-1 me-3">
                            <h1 class="page-heading d-flex flex-column justify-content-center text-gray-900 fw-bold fs-3 m-0">
                                Önümler
                            </h1>
                        </div>
                        <div class="d-flex align-items-center gap-2 gap-lg-3">
                            <a href="{% url 'Administrator:product_create' %}" class="btn btn-flex btn-primary h-40px fs-7 fw-bold" data-bs-toggle="tooltip" data-bs-custom-class="tooltip-inverse" title="Täze maglumat goşmak">
                                Goşmak
                            </a>
                        </div>
                    </div>
                </div>
            </div>
            <form id="dms_content" action="{% url 'Administrator:product_multi_delete' %}" method="post" class="app-content flex-column-fluid ">
                {% csrf_token %}
                <div id="dms_content_container" class="app-container  container-fluid ">
                    <div class="card card-flush">
                        <div class="card-header align-items-center py-5 gap-2 gap-md-5">
                            <div class="card-title">
                                <div class="d-flex align-items-center position-relative my-1 gap-1">
                                    <input type="text" class="form-control form-control-solid w-250px" name="search" id="search_input" value="{{ search }}" placeholder="Gözleg..."/>
                                    <button type="button" onclick="formSearch()" data-bs-toggle="tooltip" title="Gözleg" data-bs-custom-class="tooltip-inverse" class="btn btn-light btn-active-color-primary light cursor-pointer w-25px justify-content-center align-items-center" style="display: flex">
                                        <i class="fas fa-search fs-4"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="card-toolbar flex-row-fluid justify-content-end gap-5">
                                <div class="card-toolbar flex-row-fluid justify-content-end gap-5">
                                    <div>
                                        <h4 class="text-gray-900 cursor-default">Jemi: {{ models_all }}</h4>
                                    </div>
                                    <button type="button" onclick="document.getElementById('dms_content').submit()" class="btn btn-danger w-25px justify-content-center align-items-center" data-bs-toggle="tooltip" title="Saýlanan maglumatlary pozmak" id="delete_btn" style="display: flex">
                                        <i class="fas fa-trash fs-4" style="padding-left: 5px"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div class="card-body pt-0">
                            <table class="table align-middle table-row-dashed fs-6 gy-5" id="kt_models_table">
                                <thead>
                                <tr class="text-start text-gray-500 fw-bold fs-7 text-uppercase gs-0">
                                    <th class="w-10px pe-2">
                                        <div class="form-check form-check-sm form-check-custom form-check-solid me-3">
                                            <input class="form-check-input" type="checkbox" onclick="delete_all_btn()" data-kt-check="true" data-kt-check-target="#models_table .form-check-input"/>
                                        </div>
                                    </th>
                                    <th class="min-w-200px cursor-pointer text-hover-primary" data-bs-toggle="tooltip" title="Elepbiý boýunça tertiplemek" data-bs-custom-class="tooltip-inverse" data-kt-check="true" data-kt-check-target="#kt_ecommerce_sales_table .form-check-input"
                                        onclick="">Ady
                                    </th>
                                    <th class="cursor-default">Bahasy</th>
                                    <th class="cursor-default">Arzanlan bahasy</th>
                                    <th class="cursor-default">Göterim</th>
                                    <th class="cursor-default">Ýagdaýy</th>
                                    <th class="cursor-default">Çykdaýjysy</th>
                                    <th class="cursor-default">Girdeýjisi</th>
                                    <th class="cursor-default">Bermeli göterim</th>
                                    <th class="text-end cursor-default">Amallar</th>
                                </tr>
                                </thead>
                                <tbody class="fw-semibold text-gray-600">
                                {% for model in models %}
                                    <tr>
                                        <td>
                                            <div class="form-check form-check-sm form-check-custom form-check-solid">
                                                <input class="form-check-input" type="checkbox" onclick="delete_btn_count()" name="item_id" value="{{ model.id }}"/>
                                            </div>
                                        </td>
                                        <td>
                                            <div class="d-flex align-items-center">
                                                <p class="symbol symbol-50px cursor-pointer">
                                                    <span class="symbol-label" style="background-image:url('/media/{{ model.image }}');"></span>
                                                </p>
                                                <div class="ms-5">
                                                    <a href="{% url 'Administrator:product_warehouse_list' model.pk %}" class="text-gray-800 text-hover-primary fs-5 fw-bold" data-kt-ecommerce-product-filter="product_name">{{ model.name }}</a>
                                                </div>
                                            </div>
                                        </td>
                                        <td>
                                            <div class="d-flex align-items-center">
                                                <div class="text-gray-800 fs-5 fw-bold cursor-default">
                                                    {{ model.price }}
                                                </div>
                                            </div>
                                        </td>
                                        <td>
                                            <div class="d-flex align-items-center">
                                                <div class="text-gray-800 fs-5 fw-bold cursor-default">
                                                    {{ model.expensive_price }}
                                                </div>
                                            </div>
                                        </td>
                                        <td>
                                            <div class="d-flex align-items-center">
                                                <div class="text-gray-800 fs-5 fw-bold cursor-default">
                                                    {% if model.display_percentage == False %}
                                                        <div class="badge badge-light">Ýok</div>
                                                    {% else %}
                                                        {{ model.display_percentage }}%
                                                    {% endif %}
                                                </div>
                                            </div>
                                        </td>
                                        <td>
                                            <div class="d-flex align-items-center">
                                                {% for status in status_list %}
                                                    {% if model.status == status.0 %}
                                                        <div class="badge badge-light-{% if status.0 == '1' %}success{% elif status.0 == '2' %}danger{% else %}warning{% endif %}">{{ status.1 }}</div>
                                                    {% endif %}
                                                {% endfor %}
                                            </div>
                                        </td>
                                        <td>
                                            <div class="d-flex align-items-center">
                                                <div class="text-gray-800 fs-5 fw-bold cursor-default">
                                                    {{ model.cost }}
                                                </div>
                                            </div>
                                        </td>
                                        <td>
                                            <div class="d-flex align-items-center">
                                                <div class="text-gray-800 fs-5 fw-bold cursor-default">
                                                    {{ model.price_cost }}
                                                </div>
                                            </div>
                                        </td>
                                        <td>
                                            <div class="d-flex align-items-center">
                                                <div class="text-gray-800 fs-5 fw-bold cursor-default">
                                                    {% if model.cash_balance == 0 %}
                                                        <div class="badge badge-light">Ýok</div>
                                                    {% else %}
                                                        {{ model.cash_balance }}%
                                                    {% endif %}
                                                </div>

                                            </div>
                                        </td>
                                        <td class="text-end">
                                            <div class="btn btn-sm btn-light btn-flex btn-center btn-active-light-primary" data-kt-menu-trigger="click" data-kt-menu-placement="bottom-end">
                                                Amal
                                                <i class="px-2 fas fa-chevron-down"></i>
                                            </div>
                                            <div class="menu menu-sub menu-sub-dropdown menu-column menu-rounded menu-gray-600 menu-state-bg-light-primary fw-semibold fs-7 w-125px py-4" data-kt-menu="true">
                                                <div class="menu-item px-3">
                                                    <a onclick="window.location.href = '{% url 'Administrator:product_update' model.pk %}'" class="menu-link px-3">
                                                        Üýtegetmek
                                                    </a>
                                                </div>
                                                <div class="menu-item px-3">
                                                    <a href="#" class="menu-link px-3" onclick="item_delete(`{% url 'Administrator:product_delete' model.id %}`)">
                                                        Pozmak
                                                    </a>
                                                </div>
                                            </div>
                                        </td>
                                    </tr>
                                {% endfor %}
                                </tbody>
                            </table>
                            <div class="row">
                                <div class="col-sm-12 col-md-5 d-flex align-items-center justify-content-center justify-content-md-start">
                                    <div class="dataTables_length">
                                        <label>
                                            <select name="limit" class="form-select form-select-sm form-select-solid" id="limit_input"
                                                    onchange="form_limit()">
                                                <option value="10" {% if limit == '10' %} selected {% endif %}>10</option>
                                                <option value="25" {% if limit == '25' %} selected {% endif %}>25</option>
                                                <option value="50" {% if limit == '50' %} selected {% endif %}>50</option>
                                                <option value="100" {% if limit == '100' %} selected {% endif %}>100
                                                </option>
                                            </select>
                                        </label>
                                    </div>
                                </div>
                                <div class="col-sm-12 col-md-7 d-flex align-items-center justify-content-center justify-content-md-end">
                                    <div class="dataTables_paginate paging_simple_numbers" id="kt_inbox_listing_paginate">
                                        <ul class="pagination">
                                            {% if page_obj.has_previous %}
                                                <li class="paginate_button page-item previous"><a
                                                        href="?page={{ page_obj.previous_page_number }}&&warehouse={{ warehouse_get }}&date={{ date_get }}&status={{ status_get }}&limit={{ limit }}"
                                                        class="page-link">Yza</a></li>
                                            {% else %}
                                                <li class="paginate_button page-item previous disabled"
                                                    style="cursor:no-drop;"><a href="" class="page-link">Yza</a></li>
                                            {% endif %}
                                            {% if page_obj.number|add:'-4' > 1 %}
                                                <li class="paginate_button page-item"><a
                                                        href="?page=1&warehouse={{ warehouse_get }}&date={{ date_get }}&status={{ status_get }}&limit={{ limit }}"
                                                        class="page-link">1</a></li>
                                                <li class="paginate_button page-item"><a
                                                        href="?page={{ page_obj.number|add:'-4' }}&warehouse={{ warehouse_get }}&date={{ date_get }}&status={{ status_get }}&limit={{ limit }}"
                                                        class="page-link">&hellip;</a></li>
                                            {% endif %}
                                            {% for i in page_obj.paginator.page_range %}
                                                {% if page_obj.number == i %}
                                                    <li class="paginate_button page-item active"><a
                                                            href="?page={{ i }}&warehouse={{ warehouse_get }}&date={{ date_get }}&status={{ status_get }}&limit={{ limit }}"
                                                            class="page-link">{{ i }}</a></li>
                                                {% elif i > page_obj.number|add:'-4' and i < page_obj.number|add:'4' %}
                                                    <li class="paginate_button page-item"><a
                                                            href="?page={{ i }}&warehouse={{ warehouse_get }}&date={{ date_get }}&status={{ status_get }}&limit={{ limit }}"
                                                            class="page-link">{{ i }}</a></li>
                                                {% endif %}
                                            {% endfor %}
                                            {% if page_obj.paginator.num_pages > page_obj.number|add:'4' %}
                                                <li class="paginate_button page-item"><a
                                                        href="?page={{ page_obj.number|add:'4' }}&warehouse={{ warehouse_get }}&date={{ date_get }}&status={{ status_get }}&limit={{ limit }}"
                                                        class="page-link">&hellip;</a></li>
                                                <li class="paginate_button page-item"><a
                                                        href="?page={{ page_obj.paginator.num_pages }}&warehouse={{ warehouse_get }}&date={{ date_get }}&status={{ status_get }}&limit={{ limit }}"
                                                        class="page-link">{{ page_obj.paginator.num_pages }}</a></li>
                                            {% endif %}
                                            {% if page_obj.has_next %}
                                                <li class="paginate_button page-item next"><a
                                                        href="?page={{ page_obj.next_page_number }}&warehouse={{ warehouse_get }}&date={{ date_get }}&status={{ status_get }}&limit={{ limit }}"
                                                        class="page-link">Öňe</a></li>
                                            {% else %}
                                                <li class="paginate_button page-item next disabled" style="cursor:no-drop;">
                                                    <a href="" class="page-link">Öňe</a></li>
                                            {% endif %}
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </form>
        </div>
    </div>
    <div class="modal fade" id="excel_modal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered mw-1000px">
            <div class="modal-content">
                <div class="modal-header py-7 d-flex justify-content-between">
                    <h2>Maglumaty Exceliň üsti bilen ýüklemek</h2>
                    <div class="btn btn-lg btn-icon btn-active-color-danger me-n2 position-relative z-index-1"
                         data-bs-dismiss="modal">
                          <span class="svg-icon svg-icon-1">
                            <svg width="52" height="52" viewBox="0 0 22 22" fill="none"
                                 xmlns="http://www.w3.org/2000/svg">
                              <rect opacity="0.3" x="2" y="2" width="20" height="20" rx="5" fill="currentColor"></rect>
                              <rect x="7" y="15.3137" width="12" height="2" rx="1" transform="rotate(-45 7 15.3137)"
                                    fill="currentColor"></rect>
                              <rect x="8.41422" y="7" width="12" height="2" rx="1" transform="rotate(45 8.41422 7)"
                                    fill="currentColor"></rect>
                            </svg>
                          </span>
                    </div>
                </div>
                <div class="modal-body scroll-y m-5">
                    <div class="stepper stepper-links d-flex flex-column" id="kt_modal_offer_a_deal_stepper">
                        <div class="current" data-kt-stepper-element="content">
                            <div class="w-100">
                                <div class="fv-row mb-15" data-kt-buttons="true">
                                    <a href="{% url 'Administrator:warehouse_excel_download' %}"
                                       class="btn btn-outline btn-outline-dashed btn-active-light-primary d-flex text-start p-6"
                                       data-bs-dismiss="">
                                            <span class="d-flex">
                                                <span class="svg-icon svg-icon-3hx">
                                                       <i class="fas fa-download fs-4x"></i>
                                                </span>
                                                <span class="ms-4">
                                                    <span class="fs-3 fw-bold text-gray-900 mb-2 d-block">Nusgany ýüklemek</span>
                                                    <span class="fw-semibold fs-4 text-muted">
                                                        Görkezilen nusga boýunça maglumaty dolduruň
                                                    </span>
                                                </span>
                                            </span>
                                    </a>
                                    <label class="btn btn-outline btn-outline-dashed btn-active-light-primary d-flex text-start p-6 mt-6">
                                        <form action="{% url 'Administrator:warehouse_excel_upload' %}" method="post"
                                              enctype="multipart/form-data">
                                            {% csrf_token %}
                                            <input type="file" name="excel_file" style="display: none"
                                                   onchange="this.form.submit()">
                                        </form>
                                        <span class="d-flex">
                                                <span class="svg-icon svg-icon-3hx">
                                                       <i class="fas fa-upload fs-4x"></i>
                                                </span>
                                                <span class="ms-4">
                                                    <span class="fs-3 fw-bold text-gray-900 mb-2 d-block">Excel görnüşindäki maglumaty ýüklemek</span>
                                                    <span class="fw-semibold fs-4 text-muted">
                                                        Excel maglumatyň hemmesi programma girizilýär.
                                                    </span>
                                                </span>
                                            </span>
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
{% endblock %}

{% block js %}
    <script>
        "use strict";
        var KTAppEcommerceSalesListing = function () {
            var e, t, n, r, o, a = (e, n, a) => {
                r = e[0] ? new Date(e[0]) : null, o = e[1] ? new Date(e[1]) : null, $.fn.dataTable.ext.search.push((function (e, t, n) {
                    var a = r, c = o, l = new Date(moment($(t[5]).text(), "DD/MM/YYYY")), u = new Date(moment($(t[6]).text(), "DD/MM/YYYY"));
                    return null === a && null === c || null === a && c >= u || a <= l && null === c || a <= l && c >= u
                })), t.draw()
            }
            return {
                init: function () {
                    (e = document.querySelector("#kt_models_table")) && ((t = $(e).DataTable({info: !1, order: [], pageLength: 10, columnDefs: [{orderable: !1, targets: 0}, {orderable: !1, targets: 7}]})).on("draw", (function () {
                        c()
                    })), (() => {
                        const e = document.querySelector("#kt_table_flatpickr");
                        n = $(e).flatpickr({
                            altInput: !0, altFormat: "d/m/Y", dateFormat: "Y-m-d", mode: "range", onChange: function (e, t, n) {
                                a(e, t, n)
                            }
                        })
                    })(),
                        document.querySelector('[data-kt-table-filter="status"]').addEventListener("keyup", (function (e) {
                            t.search(e.target.value).draw()
                        })))
                }
            }
        }();
        KTUtil.onDOMContentLoaded((function () {
            KTAppEcommerceSalesListing.init()
        }));
    </script>
    <script>

        let delete_bool = true;
        document.getElementById("delete_btn").disabled = true;

        function delete_btn_count() {
            document.getElementById("delete_btn").disabled = document.querySelectorAll('input[type="checkbox"]:checked').length < 1;
        }

        function delete_all_btn() {
            delete_bool = !delete_bool
            document.getElementById("delete_btn").disabled = delete_bool
        }

        function item_delete(url) {
            Swal.fire({
                text: "Siz bu maglumaty pozmak islýärsiňizmi?",
                icon: "warning",
                showCancelButton: !0,
                buttonsStyling: !1,
                confirmButtonText: "Howa!",
                cancelButtonText: "Ýok",
                customClass: {confirmButton: "btn fw-bold btn-danger", cancelButton: "btn fw-bold btn-active-light-primary"}
            }).then((function (e) {
                e.value ? Swal.fire(
                    {text: "Maglumat pozuldy!.", icon: "success", buttonsStyling: !1, confirmButtonText: "Dowam et", customClass: {confirmButton: "btn fw-bold btn-primary"}}).then((function () {
                    window.location.href = `${url}`
                    t.row($(n)).remove().draw()
                })) : "cancel" === e.dismiss && Swal.fire({text: "Pozmak amaly ýerine ýetmedi", icon: "error", buttonsStyling: !1, confirmButtonText: "Dowam et", customClass: {confirmButton: "btn fw-bold btn-primary"}})
            }));
        }

        function getSelectValues(select) {
            let result = [];
            let options = select && select.options;
            let opt;

            for (let i = 0, iLen = options.length; i < iLen; i++) {
                opt = options[i];

                if (opt.selected) {
                    result.push(opt.value || opt.text);
                }
            }
            return result;
        }

        function formSearch() {
            let warehouse = document.getElementById('warehouse_value')
            let date = document.getElementById('kt_table_flatpickr').value
            let status = document.getElementById('status_value').value
            window.location.href = `?warehouse=${getSelectValues(warehouse)}&page=1&date=${date}&status=${status}`
        }

        function form_order_by() {
            let orderBy = document.getElementById('order_by_inout').value
            let search = document.getElementById('search_input').value
            if (orderBy === 'name') {
                window.location.href = `?order_by=-name&page={{ page }}&limit={{ limit }}&search=${search}`
            } else {
                window.location.href = `?order_by=name&page={{ page }}&limit={{ limit }}&search=${search}`
            }
        }

        function form_limit() {
            let warehouse = document.getElementById('warehouse_value')
            let date = document.getElementById('kt_table_flatpickr').value
            let status = document.getElementById('status_value').value
            let limit = document.getElementById('limit_input').value
            window.location.href = `?warehouse=${getSelectValues(warehouse)}&page=1&date=${date}&status=${status}&limit=${limit}`
        }
    </script>
{% endblock %}
