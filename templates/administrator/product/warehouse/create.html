{% extends 'administrator/base/base.html' %}
{% load static %}
{% block content %}
    <form method="post" class="d-flex flex-column flex-column-fluid">
        <div id="kt_app_toolbar" class="app-toolbar pt-6 pb-2">
            <div id="kt_app_toolbar_container" class="app-container  container-fluid d-flex align-items-stretch ">
                <div class="app-toolbar-wrapper d-flex flex-stack flex-wrap gap-4 w-100">
                    <div class="page-title d-flex flex-column justify-content-center gap-1 me-3">
                        <h1 class="page-heading d-flex flex-column justify-content-center text-gray-900 fw-bold fs-3 m-0">
                            Harydyń resepiti
                        </h1>
                    </div>
                    <div class="d-flex align-items-center gap-2 gap-lg-3">
                        <a href="{% url 'Administrator:product_warehouse_list' pk %}" class="btn btn-flex btn-outline btn-color-gray-700 btn-active-color-primary bg-body h-40px fs-7 fw-bold">
                            Yza
                        </a>
                        <button type="submit" class="btn btn-flex btn-primary h-40px fs-7 fw-bold">
                            Ýatda sakla
                        </button>
                    </div>
                </div>
            </div>
        </div>
        {% csrf_token %}
        <div id="kt_app_content" class="app-content  flex-column-fluid ">
            <div id="kt_app_content_container" class="app-container  container-fluid ">
                <div class="form d-flex flex-column flex-lg-row">
                    {% csrf_token %}
                    <div class="d-flex flex-column flex-column-fluid">
                        <div class="card card-flush py-4">
                            <div class="card-header">

                            </div>
                            <div class="card-body pt-0">
                                <div class="mb-10 fv-row">
                                    <label class="required form-label">Resept</label>
                                    <select class="form-select mb-2" data-control="select2" data-hide-search="true" name="warehouse" data-placeholder="Resepiti saýlaň" id="kt_ecommerce_add_product_status_select" required>
                                        <option></option>
                                        {% for warehouse in warehouse_models %}
                                            <option value="{{ warehouse.id }}">{{ warehouse.name }}</option>
                                        {% endfor %}
                                    </select>
                                </div>
                                <div class="mb-10 fv-row">
                                    <label class="required form-label">Mukdary (kg)</label>
                                    <input type="number" name="amount" step="0.001" onblur="this.toFixed(3)" value="" class="form-control mb-2" required placeholder="Reseptiň mukdary"/>
                                </div>
                            </div>

                        </div>
                    </div>
                </div>
            </div>
        </div>
    </form>
{% endblock %}
{% block js %}
    <script src="{% static 'administrator/assets/js/custom/ecommerce/save-product.js' %}"></script>
    <script>
        const btn = document.getElementById('submit_btn')
        const nameInput = document.getElementById('name');
        const priceInput = document.getElementById('price');

        nameInput.addEventListener('input', checkInputs);
        priceInput.addEventListener('input', checkInputs);

        const price = document.querySelector('#price')
        price.addEventListener('change', e => {
            e.currentTarget.value = parseFloat(e.currentTarget.value).toFixed(3)
        })

        function percentage() {
            const span = document.getElementById('kt_ecommerce_add_product_discount_label');
            const value = span.textContent;
            document.getElementById('percentage_input').value = value
        }

        function submitData() {
            const price = document.getElementById('price').value;
            const formData = new FormData();
            formData.append('name', name);
            formData.append('price', price);
            fetch('{% url 'Administrator:product_create' %}', {
                method: 'POST',
                headers: {
                    'X-CSRFToken': csrfToken,
                },
                body: formData,
            }).then(response => {
                if (response.status === 200) {
                    return response.json();
                } else {
                    throw new Error('' + response.status);
                }
            })
                .then(data => {
                    toastr.success('Maglumat girizildi');
                    document.getElementById('name').value = null;
                    document.getElementById('price').value = null;
                    document.getElementById('kt_ecommerce_add_product_status_select').selectedIndex = 0;
                    document.getElementById('description').value = null;
                    document.getElementById('percentage_input').value = null;
                    document.getElementById('expensive_price').value = null;
                    document.getElementById('images').files = null;
                    setTimeout(() => {
                        window.location.href = '{% url 'Administrator:product_list' %}';
                    }, 2000);

                })
                .catch(error => {
                    console.log(error)
                    toastr.error('Ýalňyşlyk ýüze çykdy');
                });
        }
    </script>
    <script src="{% static 'administrator/assets/js/custom/formrepeater/formrepeater.bundle.js' %}"></script>
{% endblock %}
