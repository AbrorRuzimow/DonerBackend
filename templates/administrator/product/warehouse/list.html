{% extends 'administrator/base/base.html' %}
{% block content %}
    <div class="app-main flex-column flex-row-fluid " id="kt_app_main">
        <div class="d-flex flex-column flex-column-fluid">
            <div id="kt_app_toolbar" class="app-toolbar  pt-6 pb-2 ">
                <div id="kt_app_toolbar_container" class="app-container  container-fluid d-flex align-items-stretch ">
                    <div class="app-toolbar-wrapper d-flex flex-stack flex-wrap gap-4 w-100">
                        <div class="page-title d-flex flex-column justify-content-center gap-1 me-3">
                            <h1 class="page-heading d-flex flex-column justify-content-center text-gray-900 fw-bold fs-3 m-0">
                                {{ product.name }}
                            </h1>
                        </div>

                        <div class="d-flex align-items-center gap-2 gap-lg-3">
                            <a href="{% url 'Administrator:product_cash_back' pk %}" class="btn btn-sm btn-flex btn-light-success">
                                Cash back
                            </a>
                            <a href="{% url 'Administrator:product_warehouse_create' pk %}" class="btn btn-sm btn-flex btn-light-primary">
                                Resept goşmak
                            </a>
                        </div>
                    </div>
                </div>
            </div>
            <div id="kt_app_content" class="app-content  flex-column-fluid ">
                <div id="kt_app_content_container" class="app-container  container-fluid ">
                    <div class="d-flex flex-column flex-xl-row">
                        <div class="flex-column flex-lg-row-auto w-100 w-xl-350px mb-10">
                            <div class="card mb-5 mb-xl-8">
                                <div class="card-body pt-15">
                                    <div class="d-flex flex-center flex-column mb-5">
                                        <a href="#" class="fs-3 text-gray-800 text-hover-primary fw-bold mb-1">
                                            {{ product.name }}
                                        </a>
                                        <a href="#" class="fs-5 fw-semibold text-muted text-hover-primary mb-6">
                                            {{ models.phone_number }}
                                        </a>
                                    </div>
                                    <div class="d-flex flex-stack fs-4 py-3">
                                        <div class="fw-bold">
                                            {{ product.name }} ýagdaýy
                                        </div>
                                    </div>
                                    <div class="separator separator-dashed my-3"></div>
                                    <div class="pb-5 fs-6">
                                        <div class="fw-bold mt-5">Gerek bolan reseptler</div>
                                        <div class="text-gray-600">{{ count }}</div>
                                        <div class="fw-bold mt-5">Bahasy</div>
                                        <div class="text-gray-600">{{ product.price }} TMT</div>
                                        <div class="fw-bold mt-5">Çykdaýjy</div>
                                        <div class="text-gray-600">{{ product.cost }} TMT</div>
                                        <div class="fw-bold mt-5">Peýda</div>
                                        <div class="text-gray-600">{{ product.price_cost }} TMT</div>
                                        <div class="fw-bold mt-5">Cash Back göterim</div>
                                        <div class="text-gray-600">
                                            {{ product.cash_balance }}%
                                        </div>
                                        <div class="fw-bold mt-5">Cash back</div>
                                        <div class="text-gray-600">{{ my_cash_balance|floatformat:2 }} TMT</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="flex-lg-row-fluid ms-lg-15">
                            <div class="tab-pane fade show active" id="kt_ecommerce_customer_overview" role="tabpanel">
                                <div class="card pt-4 mb-6 mb-xl-9">
                                    <div class="card-header border-0">
                                        <div class="card-title">
                                            <h2>Sebetdäki harytlar</h2>
                                        </div>
                                    </div>
                                    <div class="card-body pt-0 pb-5">
                                        <table class="table align-middle table-row-dashed gy-5" id="kt_table_customers_payment">
                                            <thead class="border-bottom border-gray-200 fs-7 fw-bold">
                                            <tr class="text-start text-muted text-uppercase gs-0">
                                                <th class="cursor-pointer">Ady</th>
                                                <th class="cursor-default">Bahasy (1kg)</th>
                                                <th class="cursor-default">Mukdary (kg)</th>
                                                <th class="cursor-default">Jemi</th>
                                                <th class="cursor-default">Amal</th>
                                            </tr>
                                            </thead>
                                            <tbody class="fs-6 fw-semibold text-gray-600">
                                            {% for model in models %}
                                                <tr>
                                                    <td>
                                                        <div class="d-flex align-items-center">
                                                            <div class="ms-5">
                                                                <a href="" class="text-gray-800 text-hover-primary fs-5 fw-bold">{{ model.warehouse_name_fk.name }}</a>
                                                            </div>
                                                        </div>
                                                    </td>
                                                    <td>
                                                        <div class="d-flex align-items-center">
                                                            <div class="text-gray-800 fs-5 fw-bold cursor-default">
                                                                {{ model.price }}
                                                            </div>
                                                        </div>
                                                    </td>
                                                    <td>
                                                        <div class="d-flex align-items-center">
                                                            <div class="text-gray-800 fs-5 fw-bold cursor-default">
                                                                {{ model.amount }}
                                                            </div>
                                                        </div>
                                                    </td>
                                                    <td>
                                                        <div class="d-flex align-items-center">
                                                            <div class="text-gray-800 fs-5 fw-bold cursor-default">
                                                                {{ model.total|floatformat:2 }}
                                                            </div>
                                                        </div>
                                                    </td>
                                                    <td class="">
                                                        <div class="btn btn-sm btn-light btn-flex btn-center btn-active-light-primary" data-kt-menu-trigger="click" data-kt-menu-placement="bottom-end">
                                                            Amal
                                                            <i class="px-2 fas fa-chevron-down"></i>
                                                        </div>
                                                        <div class="menu menu-sub menu-sub-dropdown menu-column menu-rounded menu-gray-600 menu-state-bg-light-primary fw-semibold fs-7 w-125px py-4" data-kt-menu="true">
                                                            <div class="menu-item px-3">
                                                                <a onclick="window.location.href = '{% url 'Administrator:product_warehouse_update' model.pk %}'" class="menu-link px-3">
                                                                    Üýtegetmek
                                                                </a>
                                                            </div>
                                                            <div class="menu-item px-3">
                                                                <a href="#" class="menu-link px-3" onclick="item_delete(`{% url 'Administrator:product_warehouse_delete' model.id %}`)">
                                                                    Pozmak
                                                                </a>
                                                            </div>
                                                        </div>
                                                    </td>
                                                </tr>
                                            {% endfor %}
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
{% endblock %}
{% block js %}
    <script>
        "use strict";
        var KTAppEcommerceSalesListing = function () {
            var e, t, n, r, o, a = (e, n, a) => {
                r = e[0] ? new Date(e[0]) : null, o = e[1] ? new Date(e[1]) : null, $.fn.dataTable.ext.search.push((function (e, t, n) {
                    var a = r, c = o, l = new Date(moment($(t[5]).text(), "DD/MM/YYYY")), u = new Date(moment($(t[6]).text(), "DD/MM/YYYY"));
                    return null === a && null === c || null === a && c >= u || a <= l && null === c || a <= l && c >= u
                })), t.draw()
            }
            return {
                init: function () {
                    (e = document.querySelector("#kt_models_table")) && ((t = $(e).DataTable({info: !1, order: [], pageLength: 10, columnDefs: [{orderable: !1, targets: 0}, {orderable: !1, targets: 7}]})).on("draw", (function () {
                        c()
                    })), (() => {
                        const e = document.querySelector("#kt_table_flatpickr");
                        n = $(e).flatpickr({
                            altInput: !0, altFormat: "d/m/Y", dateFormat: "Y-m-d", mode: "range", onChange: function (e, t, n) {
                                a(e, t, n)
                            }
                        })
                    })(),
                        document.querySelector('[data-kt-table-filter="status"]').addEventListener("keyup", (function (e) {
                            t.search(e.target.value).draw()
                        })))
                }
            }
        }();
        KTUtil.onDOMContentLoaded((function () {
            KTAppEcommerceSalesListing.init()
        }));
    </script>
    <script>

        let delete_bool = true;
        document.getElementById("delete_btn").disabled = true;

        function delete_btn_count() {
            document.getElementById("delete_btn").disabled = document.querySelectorAll('input[type="checkbox"]:checked').length < 1;
        }

        function delete_all_btn() {
            delete_bool = !delete_bool
            document.getElementById("delete_btn").disabled = delete_bool
        }

        function item_delete(url) {
            Swal.fire({
                text: "Siz bu maglumaty pozmak islýärsiňizmi?",
                icon: "warning",
                showCancelButton: !0,
                buttonsStyling: !1,
                confirmButtonText: "Howa!",
                cancelButtonText: "Ýok",
                customClass: {confirmButton: "btn fw-bold btn-danger", cancelButton: "btn fw-bold btn-active-light-primary"}
            }).then((function (e) {
                e.value ? Swal.fire(
                    {text: "Maglumat pozuldy!.", icon: "success", buttonsStyling: !1, confirmButtonText: "Dowam et", customClass: {confirmButton: "btn fw-bold btn-primary"}}).then((function () {
                    window.location.href = `${url}`
                    t.row($(n)).remove().draw()
                })) : "cancel" === e.dismiss && Swal.fire({text: "Pozmak amaly ýerine ýetmedi", icon: "error", buttonsStyling: !1, confirmButtonText: "Dowam et", customClass: {confirmButton: "btn fw-bold btn-primary"}})
            }));
        }

        function getSelectValues(select) {
            let result = [];
            let options = select && select.options;
            let opt;

            for (let i = 0, iLen = options.length; i < iLen; i++) {
                opt = options[i];

                if (opt.selected) {
                    result.push(opt.value || opt.text);
                }
            }
            return result;
        }

        function formSearch() {
            let warehouse = document.getElementById('warehouse_value')
            let date = document.getElementById('kt_table_flatpickr').value
            let status = document.getElementById('status_value').value
            window.location.href = `?warehouse=${getSelectValues(warehouse)}&page=1&date=${date}&status=${status}`
        }

        function form_order_by() {
            let orderBy = document.getElementById('order_by_inout').value
            let search = document.getElementById('search_input').value
            if (orderBy === 'name') {
                window.location.href = `?order_by=-name&page={{ page }}&limit={{ limit }}&search=${search}`
            } else {
                window.location.href = `?order_by=name&page={{ page }}&limit={{ limit }}&search=${search}`
            }
        }

        function form_limit() {
            let warehouse = document.getElementById('warehouse_value')
            let date = document.getElementById('kt_table_flatpickr').value
            let status = document.getElementById('status_value').value
            let limit = document.getElementById('limit_input').value
            window.location.href = `?warehouse=${getSelectValues(warehouse)}&page=1&date=${date}&status=${status}&limit=${limit}`
        }
    </script>
{% endblock %}